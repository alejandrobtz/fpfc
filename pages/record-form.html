    


    

<template id="support-form-template">
  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="rounded-2xl shadow-lg p-6 w-full max-w-lg" style='font-family: "Work Sans", "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <div class="px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#191610] tracking-light text-[32px] font-bold leading-tight min-w-72">Crear/Editar Registro de Archivo</p>
            </div>
            <form id="record-form">
              <div class="flex flex-col p-4 gap-3">
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group" open="">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Información Básica (0/8)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="grid grid-cols-2 gap-4 py-4">
                    <div class="col-span-2">
                      <label class="block text-sm font-medium text-[#191610] mb-2">IMAGEN MINIATURA</label>
                      <input type="file" accept="image/*" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">CÓDIGO</label>
                      <input type="number" id="codigo" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">TÍTULO</label>
                      <input type="text" id="titulo" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">AÑO</label>
                      <select id="anio" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar año</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                        <option value="2019">2019</option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                        <option value="2015">2015</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">PAÍS</label>
                      <select id="pais" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar país</option>
                        <option value="Colombia">Colombia</option>
                        <option value="México">México</option>
                        <option value="Argentina">Argentina</option>
                        <option value="Brasil">Brasil</option>
                        <option value="Chile">Chile</option>
                        <option value="Perú">Perú</option>
                        <option value="Venezuela">Venezuela</option>
                        <option value="Ecuador">Ecuador</option>
                        <option value="Bolivia">Bolivia</option>
                        <option value="Paraguay">Paraguay</option>
                        <option value="Uruguay">Uruguay</option>
                        <option value="España">España</option>
                        <option value="Francia">Francia</option>
                        <option value="Italia">Italia</option>
                        <option value="Alemania">Alemania</option>
                        <option value="Reino Unido">Reino Unido</option>
                        <option value="Portugal">Portugal</option>
                        <option value="Países Bajos">Países Bajos</option>
                        <option value="Bélgica">Bélgica</option>
                        <option value="Estados Unidos">Estados Unidos</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">EMPRESA PRODUCTORA</label>
                      <select id="empresa" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar empresa</option>
                        <option value="Caracol Televisión">Caracol Televisión</option>
                        <option value="RCN Televisión">RCN Televisión</option>
                        <option value="Canal 13">Canal 13</option>
                        <option value="Señal Colombia">Señal Colombia</option>
                        <option value="RTVC">RTVC</option>
                        <option value="Producciones PUNCH">Producciones PUNCH</option>
                        <option value="Dynamo">Dynamo</option>
                        <option value="Fox Telecolombia">Fox Telecolombia</option>
                        <option value="Cine Colombia">Cine Colombia</option>
                        <option value="Proimágenes">Proimágenes</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">DIRECTOR/A</label>
                      <input type="text" id="director" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">DURACIÓN</label>
                      <input type="time" id="duracion" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">ACTUAL</label>
                      <input type="number" id="actual" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">ANTIGUO</label>
                      <input type="number" id="antiguo" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Identificación y Características del Material (0/10)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="grid grid-cols-2 gap-4 py-4">
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">IMAGEN</label>
                      <input type="text" id="imagen" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">SONIDO</label>
                      <input type="text" id="sonido" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div class="col-span-2">
                      <label class="block text-sm font-medium text-[#191610] mb-2">TIPO DE MATERIAL</label>
                      <div class="grid grid-cols-3 gap-4">
                        <label class="flex items-center">
                          <input type="checkbox" id="negativo" class="mr-2">
                          <span class="text-sm text-[#191610]">NEGATIVO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="positivo" class="mr-2">
                          <span class="text-sm text-[#191610]">POSITIVO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="reversible" class="mr-2">
                          <span class="text-sm text-[#191610]">REVERSIBLE</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="blanco" class="mr-2">
                          <span class="text-sm text-[#191610]">BLANCO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="negro" class="mr-2">
                          <span class="text-sm text-[#191610]">NEGRO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="color" class="mr-2">
                          <span class="text-sm text-[#191610]">COLOR</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Producción y Créditos (0/5)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="py-4">
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">PRODUCTOR EJECUTIVO</label>
                        <input type="text" id="productorEjecutivo" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">PRODUCTOR ASOCIADO</label>
                        <input type="text" id="productorAsociado" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">GUIONISTA</label>
                        <input type="text" id="guionista" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">FOTÓGRAFO</label>
                        <input type="text" id="fotografo" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">EDITOR</label>
                        <input type="text" id="editor" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Soporte Actual (0/3)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="grid grid-cols-2 gap-4 py-4">
                    <div class="col-span-2">
                      <label class="block text-sm font-medium text-[#191610] mb-2">TIPO DE SOPORTE</label>
                      <div class="grid grid-cols-5 gap-4">
                        <label class="flex items-center">
                          <input type="checkbox" id="filmico" class="mr-2">
                          <span class="text-sm text-[#191610]">FÍLMICO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="magnetico" class="mr-2">
                          <span class="text-sm text-[#191610]">MAGNÉTICO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="optico" class="mr-2">
                          <span class="text-sm text-[#191610]">ÓPTICO</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="digital" class="mr-2">
                          <span class="text-sm text-[#191610]">DIGITAL</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" id="restaurado" class="mr-2">
                          <span class="text-sm text-[#191610]">RESTAURADO</span>
                        </label>
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">FECHA RESTAURACIÓN</label>
                      <input type="date" id="fechaRestauracion" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">RESOLUCIÓN CÓDEC</label>
                      <select id="resolucionCodec" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar resolución</option>
                        <option value="4K">4K (3840x2160)</option>
                        <option value="2K">2K (2048x1080)</option>
                        <option value="1080p">1080p (1920x1080)</option>
                        <option value="720p">720p (1280x720)</option>
                        <option value="480p">480p (854x480)</option>
                        <option value="H.264">H.264</option>
                        <option value="H.265">H.265</option>
                        <option value="ProRes">ProRes</option>
                        <option value="DNxHD">DNxHD</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">PESO</label>
                      <div class="flex gap-2">
                        <input type="number" id="peso" class="flex-1 p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <button type="button" class="px-3 py-2 bg-[#f1efe9] rounded-lg text-sm font-medium">KG</button>
                        <button type="button" class="px-3 py-2 bg-[#f1efe9] rounded-lg text-sm font-medium">Grs</button>
                        <button type="button" class="px-3 py-2 bg-[#f1efe9] rounded-lg text-sm font-medium">Lbs</button>
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">ASPECT RATIO</label>
                      <select id="aspectRatio" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar ratio</option>
                        <option value="16:9">16:9</option>
                        <option value="4:3">4:3</option>
                        <option value="21:9">21:9</option>
                        <option value="1.85:1">1.85:1</option>
                        <option value="2.35:1">2.35:1</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">FPS</label>
                      <select id="fps" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <option value="">Seleccionar FPS</option>
                        <option value="24">24 fps</option>
                        <option value="25">25 fps</option>
                        <option value="30">30 fps</option>
                        <option value="50">50 fps</option>
                        <option value="60">60 fps</option>
                        <option value="120">120 fps</option>
                      </select>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Historial de pH (0/2)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="py-4">
                    <div class="mb-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">NUEVO REGISTRO DE pH</label>
                      <input type="text" id="nuevoPh" placeholder="Ingrese el valor de pH" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">HISTORIAL DE REGISTROS</label>
                      <table class="w-full border border-[#e3dfd4] rounded-lg">
                        <thead class="bg-[#f1efe9]">
                          <tr>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Valor pH</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Fecha</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Usuario</th>
                          </tr>
                        </thead>
                        <tbody id="phTableBody">
                          <tr class="border-t border-[#e3dfd4]">
                            <td class="px-4 py-2 text-sm text-[#191610]">7.2</td>
                            <td class="px-4 py-2 text-sm text-[#191610]">15/01/2024</td>
                            <td class="px-4 py-2 text-sm text-[#191610]">Admin</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Ubicación y Almacenamiento (0/4)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="py-4">
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">TIPO DE UBICACIÓN</label>
                        <select id="tipoUbicacion" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                          <option value="">Seleccionar tipo</option>
                          <option value="Signatura">Signatura</option>
                          <option value="Boveda">Bóveda</option>
                        </select>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">CÓDIGO DE UBICACIÓN</label>
                        <input type="text" id="codigoUbicacion" placeholder="Ej: SIG-001, BOV-A-12" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Descripción y Materiales Relacionados (0/2)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="py-4">
                    <div class="mb-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">SINOPSIS</label>
                      <textarea id="sinopsis" rows="4" placeholder="Ingrese la sinopsis del material..." class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white resize-none"></textarea>
                    </div>
                    <div class="mb-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">CRÉDITOS</label>
                      <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="nombrePersona" placeholder="Nombre de la persona" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                        <select id="rolPersona" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                          <option value="">Seleccionar rol</option>
                          <option value="Actor">Actor</option>
                          <option value="Producción">Producción</option>
                          <option value="Escritor">Escritor</option>
                          <option value="Director">Director</option>
                          <option value="Fotógrafo">Fotógrafo</option>
                          <option value="Editor">Editor</option>
                          <option value="Músico">Músico</option>
                          <option value="Diseñador">Diseñador</option>
                        </select>
                      </div>
                      <button type="button" onclick="this.getRootNode().host.agregarCredito()" class="mt-2 px-4 py-2 bg-[#f1efe9] rounded-lg text-sm font-medium">Agregar Crédito</button>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-[#191610] mb-2">LISTA DE CRÉDITOS</label>
                      <table class="w-full border border-[#e3dfd4] rounded-lg">
                        <thead class="bg-[#f1efe9]">
                          <tr>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Nombre</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Rol</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="creditosTableBody">
                        </tbody>
                      </table>
                    </div>
                  </div>
                </details>
                <details class="flex flex-col rounded-xl border border-[#e3dfd4] bg-[#fbfaf9] px-[15px] py-[7px] group">
                  <summary class="flex cursor-pointer items-center justify-between gap-6 py-2">
                    <p class="text-[#191610] text-sm font-medium leading-normal">Adjuntos (0/1)</p>
                    <div class="text-[#191610] group-open:rotate-180" data-icon="CaretDown" data-size="20px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                      </svg>
                    </div>
                  </summary>
                  <div class="py-4">
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-[#191610] mb-2">GUIÓN</label>
                        <input type="text" id="guion" placeholder="Ruta o referencia al guión" class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                      </div>
                      <div class="col-span-2">
                        <label class="block text-sm font-medium text-[#191610] mb-2">MATERIALES ADICIONALES</label>
                        <div class="grid grid-cols-3 gap-4">
                          <label class="flex items-center">
                            <input type="checkbox" id="fotografias" class="mr-2">
                            <span class="text-sm text-[#191610]">FOTOGRAFÍAS</span>
                          </label>
                          <label class="flex items-center">
                            <input type="checkbox" id="cartel" class="mr-2">
                            <span class="text-sm text-[#191610]">CARTEL</span>
                          </label>
                          <label class="flex items-center">
                            <input type="checkbox" id="sonidoMusica" class="mr-2">
                            <span class="text-sm text-[#191610]">SONIDO (MÚSICA)</span>
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">OBSERVACIONES</label>
                      <textarea id="observaciones" rows="3" placeholder="Ingrese observaciones adicionales..." class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white resize-none"></textarea>
                    </div>
                    <div class="mt-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">HISTORIAL DE OBSERVACIONES</label>
                      <table class="w-full border border-[#e3dfd4] rounded-lg">
                        <thead class="bg-[#f1efe9]">
                          <tr>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Observación</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Usuario</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-[#191610]">Fecha</th>
                          </tr>
                        </thead>
                        <tbody id="observacionesTableBody">
                          <tr class="border-t border-[#e3dfd4]">
                            <td class="px-4 py-2 text-sm text-[#191610]">Material en buen estado</td>
                            <td class="px-4 py-2 text-sm text-[#191610]">Admin</td>
                            <td class="px-4 py-2 text-sm text-[#191610]">15/01/2024</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="mt-4">
                      <label class="block text-sm font-medium text-[#191610] mb-2">LINK KOHA</label>
                      <input type="url" id="linkKoha" placeholder="https://..." class="w-full p-2 border border-[#e3dfd4] rounded-lg bg-white">
                    </div>
                  </div>
                </details>
              </div>
              <div class="flex justify-stretch">
                <div class="flex flex-1 gap-3 flex-wrap px-4 py-3 justify-end">
                  <button
                    id="save-draft-btn"
                    onclick="this.getRootNode().host.guardarBorrador()"
                    type="submit"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#f1efe9] text-[#191610] text-sm font-bold leading-normal tracking-[0.015em]"
                  >
                    <span class="truncate">Guardar Borrador</span>
                  </button>
                  <button
                    id="save-btn"
                    onclick="this.getRootNode().host.guardarYCerrar()"
                    type="submit"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#f3ecd8] text-[#191610] text-sm font-bold leading-normal tracking-[0.015em]"
                  >
                    <span class="truncate">Guardar y Cerrar</span>
                  </button>
                  <button
                    id="cancel-btn"
                    onclick="this.getRootNode().host.close()"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-transparent text-[#191610] text-sm font-bold leading-normal tracking-[0.015em]"
                  >
                    <span class="truncate">Cancelar</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

</template>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
  // Array to store credits
  let creditos = []; // Move this outside the class as a global variable
  
  class RecordForm extends HTMLElement{
    constructor(){
      super();
      const template = document.getElementById('support-form-template').content.cloneNode(true);
      this.attachShadow({mode:"open"}).appendChild(template);

      // Fix: Use the correct form selector and add proper event handling
      this.shadowRoot.querySelector('#cancel-btn').addEventListener('click', () => this.close());
      this.shadowRoot.querySelector('#record-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        this.dispatchEvent(new CustomEvent('form-submitted', {detail: Object.fromEntries(formData)}));
        this.close();
      });

      // Initialize form reference
      this.form = this.shadowRoot.querySelector('#record-form');
    }

    open(){
      this.style.display = 'block';
    }

    close(){
      this.style.display = 'none';
    }

    connectedCallback() {
      this.style.display = 'none'; // hidden by default
      this.style.position = 'fixed';
      this.style.top = 0;
      this.style.left = 0;
      this.style.width = '100%';
      this.style.height = '100%';
      this.style.zIndex = 9999;
    }

    // Move these properties outside the class or initialize them properly
    currentRecordId = null;

    // Function to add credit - fix scope issues
    agregarCredito() {
      const nombre = this.shadowRoot.querySelector('#nombrePersona').value;
      const rol = this.shadowRoot.querySelector('#rolPersona').value;
      
      if (nombre && rol) {
        const credito = {
          id: Date.now(),
          nombre: nombre,
          rol: rol
        };
        
        creditos.push(credito);
        this.actualizarTablaCreditos();
        
        // Clear inputs
        this.shadowRoot.querySelector('#nombrePersona').value = '';
        this.shadowRoot.querySelector('#rolPersona').value = '';
      } else {
        alert('Por favor complete todos los campos');
      }
    }

    // Function to update credits table - fix scope issues
    actualizarTablaCreditos() {
      const tbody = this.shadowRoot.querySelector('#creditosTableBody');
      tbody.innerHTML = '';
      
      creditos.forEach(credito => {
        const row = document.createElement('tr');
        row.className = 'border-t border-[#e3dfd4]';
        row.innerHTML = `
          <td class="px-4 py-2 text-sm text-[#191610]">${credito.nombre}</td>
          <td class="px-4 py-2 text-sm text-[#191610]">${credito.rol}</td>
          <td class="px-4 py-2 text-sm text-[#191610]">
            <button onclick="this.getRootNode().host.eliminarCredito(${credito.id})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">Eliminar</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Function to remove credit - fix scope issues
    eliminarCredito(id) {
      creditos = creditos.filter(c => c.id !== id);
      this.actualizarTablaCreditos();
    }

    // Function to save draft - fix scope issues
    guardarBorrador() {
      const formData = this.obtenerDatosFormulario();
      formData.estado = 'borrador';
      this.guardarRegistro(formData);
    }

    // Function to save and close - fix scope issues
    guardarYCerrar() {
      const formData = this.obtenerDatosFormulario();
      formData.estado = 'completado';
      this.guardarRegistro(formData);
      this.close();
    }

    // Function to get form data - fix scope issues
    obtenerDatosFormulario() {
      return {
        id: this.currentRecordId || Date.now(),
        codigo: this.shadowRoot.querySelector('#codigo').value,
        titulo: this.shadowRoot.querySelector('#titulo').value,
        anio: this.shadowRoot.querySelector('#anio').value,
        pais: this.shadowRoot.querySelector('#pais').value,
        empresa: this.shadowRoot.querySelector('#empresa').value,
        director: this.shadowRoot.querySelector('#director').value,
        duracion: this.shadowRoot.querySelector('#duracion').value,
        actual: this.shadowRoot.querySelector('#actual').value,
        antiguo: this.shadowRoot.querySelector('#antiguo').value,
        productorEjecutivo: this.shadowRoot.querySelector('#productorEjecutivo').value,
        productorAsociado: this.shadowRoot.querySelector('#productorAsociado').value,
        guionista: this.shadowRoot.querySelector('#guionista').value,
        fotografo: this.shadowRoot.querySelector('#fotografo').value,
        editor: this.shadowRoot.querySelector('#editor').value,
        imagen: this.shadowRoot.querySelector('#imagen').value,
        sonido: this.shadowRoot.querySelector('#sonido').value,
        negativo: this.shadowRoot.querySelector('#negativo').checked,
        positivo: this.shadowRoot.querySelector('#positivo').checked,
        reversible: this.shadowRoot.querySelector('#reversible').checked,
        blanco: this.shadowRoot.querySelector('#blanco').checked,
        negro: this.shadowRoot.querySelector('#negro').checked,
        color: this.shadowRoot.querySelector('#color').checked,
        filmico: this.shadowRoot.querySelector('#filmico').checked,
        magnetico: this.shadowRoot.querySelector('#magnetico').checked,
        optico: this.shadowRoot.querySelector('#optico').checked,
        digital: this.shadowRoot.querySelector('#digital').checked,
        restaurado: this.shadowRoot.querySelector('#restaurado').checked,
        fechaRestauracion: this.shadowRoot.querySelector('#fechaRestauracion').value,
        resolucionCodec: this.shadowRoot.querySelector('#resolucionCodec').value,
        peso: this.shadowRoot.querySelector('#peso').value,
        aspectRatio: this.shadowRoot.querySelector('#aspectRatio').value,
        fps: this.shadowRoot.querySelector('#fps').value,
        nuevoPh: this.shadowRoot.querySelector('#nuevoPh').value,
        tipoUbicacion: this.shadowRoot.querySelector('#tipoUbicacion').value,
        codigoUbicacion: this.shadowRoot.querySelector('#codigoUbicacion').value,
        sinopsis: this.shadowRoot.querySelector('#sinopsis').value,
        creditos: creditos,
        guion: this.shadowRoot.querySelector('#guion').value,
        fotografias: this.shadowRoot.querySelector('#fotografias').checked,
        cartel: this.shadowRoot.querySelector('#cartel').checked,
        sonidoMusica: this.shadowRoot.querySelector('#sonidoMusica').checked,
        observaciones: this.shadowRoot.querySelector('#observaciones').value,
        linkKoha: this.shadowRoot.querySelector('#linkKoha').value,
        fechaCreacion: new Date().toISOString()
      };
    }

    // Function to save record - fix scope issues
    guardarRegistro(data) {
      // Save to localStorage for demo purposes
      // In a real application, this would be an API call
      const registros = JSON.parse(localStorage.getItem('registros') || '[]');
      
      if (this.currentRecordId) {
        // Update existing record
        const index = registros.findIndex(r => r.id === this.currentRecordId);
        if (index !== -1) {
          registros[index] = data;
        }
      } else {
        // Add new record
        registros.push(data);
      }
      
      localStorage.setItem('registros', JSON.stringify(registros));
      
      // Notify parent window if this is opened as a popup
      if (window.opener) {
        window.opener.postMessage({
          type: 'RECORD_SAVED',
          data: data
        }, '*');
      }
      
      alert('Registro guardado exitosamente');
    }

    // Function to load record data for editing - fix scope issues
    cargarRegistro(id) {
      const registros = JSON.parse(localStorage.getItem('registros') || '[]');
      const registro = registros.find(r => r.id === id);
      
      if (registro) {
        this.currentRecordId = registro.id;
        this.shadowRoot.querySelector('#codigo').value = registro.codigo || '';
        this.shadowRoot.querySelector('#titulo').value = registro.titulo || '';
        this.shadowRoot.querySelector('#anio').value = registro.anio || '';
        this.shadowRoot.querySelector('#pais').value = registro.pais || '';
        this.shadowRoot.querySelector('#empresa').value = registro.empresa || '';
        this.shadowRoot.querySelector('#director').value = registro.director || '';
        this.shadowRoot.querySelector('#duracion').value = registro.duracion || '';
        this.shadowRoot.querySelector('#actual').value = registro.actual || '';
        this.shadowRoot.querySelector('#antiguo').value = registro.antiguo || '';
        this.shadowRoot.querySelector('#productorEjecutivo').value = registro.productorEjecutivo || '';
        this.shadowRoot.querySelector('#productorAsociado').value = registro.productorAsociado || '';
        this.shadowRoot.querySelector('#guionista').value = registro.guionista || '';
        this.shadowRoot.querySelector('#fotografo').value = registro.fotografo || '';
        this.shadowRoot.querySelector('#editor').value = registro.editor || '';
        this.shadowRoot.querySelector('#imagen').value = registro.imagen || '';
        this.shadowRoot.querySelector('#sonido').value = registro.sonido || '';
        this.shadowRoot.querySelector('#negativo').checked = registro.negativo || false;
        this.shadowRoot.querySelector('#positivo').checked = registro.positivo || false;
        this.shadowRoot.querySelector('#reversible').checked = registro.reversible || false;
        this.shadowRoot.querySelector('#blanco').checked = registro.blanco || false;
        this.shadowRoot.querySelector('#negro').checked = registro.negro || false;
        this.shadowRoot.querySelector('#color').checked = registro.color || false;
        this.shadowRoot.querySelector('#filmico').checked = registro.filmico || false;
        this.shadowRoot.querySelector('#magnetico').checked = registro.magnetico || false;
        this.shadowRoot.querySelector('#optico').checked = registro.optico || false;
        this.shadowRoot.querySelector('#digital').checked = registro.digital || false;
        this.shadowRoot.querySelector('#restaurado').checked = registro.restaurado || false;
        this.shadowRoot.querySelector('#fechaRestauracion').value = registro.fechaRestauracion || '';
        this.shadowRoot.querySelector('#resolucionCodec').value = registro.resolucionCodec || '';
        this.shadowRoot.querySelector('#peso').value = registro.peso || '';
        this.shadowRoot.querySelector('#aspectRatio').value = registro.aspectRatio || '';
        this.shadowRoot.querySelector('#fps').value = registro.fps || '';
        this.shadowRoot.querySelector('#nuevoPh').value = registro.nuevoPh || '';
        this.shadowRoot.querySelector('#tipoUbicacion').value = registro.tipoUbicacion || '';
        this.shadowRoot.querySelector('#codigoUbicacion').value = registro.codigoUbicacion || '';
        this.shadowRoot.querySelector('#sinopsis').value = registro.sinopsis || '';
        this.shadowRoot.querySelector('#guion').value = registro.guion || '';
        this.shadowRoot.querySelector('#fotografias').checked = registro.fotografias || false;
        this.shadowRoot.querySelector('#cartel').checked = registro.cartel || false;
        this.shadowRoot.querySelector('#sonidoMusica').checked = registro.sonidoMusica || false;
        this.shadowRoot.querySelector('#observaciones').value = registro.observaciones || '';
        this.shadowRoot.querySelector('#linkKoha').value = registro.linkKoha || '';
        
        if (registro.creditos) {
          creditos = registro.creditos;
          this.actualizarTablaCreditos();
        }
      }
    }

    set Data(values){
      Object.entries(values).forEach(([key, value]) => {
        const input = this.form.querySelector(`#${key}`);
        if (input) input.value = value;
      });
    }
  }
  
  // Move this outside the class definition
  customElements.define('support-form-template', RecordForm);
</script>